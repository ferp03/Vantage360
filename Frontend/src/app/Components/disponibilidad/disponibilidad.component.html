<div class="dashboard-bg">
  <!-- Barra de búsqueda y filtros -->
  <div class="filtro-div">
    <div class="titulo">
      <h1>Disponibilidad de Empleados</h1>
    </div>
    <!-- Buscador -->
    <form class="form" style="margin-left: 10px; width: 60vw;">
      <svg
        width="17"
        height="16"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        role="img"
        aria-labelledby="search"
      >
        <path
          d="M7.667 12.667A5.333 5.333 0 107.667 2a5.333 5.333 0 000 10.667zM14.334 14l-2.9-2.9"
          stroke="currentColor"
          stroke-width="1.333"
          stroke-linecap="round"
          stroke-linejoin="round"
        ></path>
      </svg>
      <input
        class="input"
        placeholder="Buscar empleado"
        [(ngModel)]="searchText"
        name="searchText"
        type="text"
        (keyup)="aplicarFiltros()"
      />
      <button class="reset" type="reset" (click)="searchText = ''; aplicarFiltros()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </form>
  </div>

  <!-- Filtros avanzados -->
  <div class="filtros-avanzados">
    <div class="filtro-item">
      <label for="filtroRol">Rol:</label>
      <select id="filtroRol" [(ngModel)]="filtros.rol" (change)="aplicarFiltros()">
        <option value="">Todos</option>
        <option *ngFor="let r of rolesUnicos" [value]="r">{{r}}</option>
      </select>
    </div>

    <div class="filtro-item">
      <label for="filtroHabilidad">Habilidad:</label>
      <select id="filtroHabilidad" [(ngModel)]="filtros.habilidad" (change)="aplicarFiltros()">
        <option value="">Todas</option>
        <option *ngFor="let h of habilidadesUnicas" [value]="h">{{h}}</option>
      </select>
    </div>

    <div class="filtro-item">
      <label for="filtroCertificacion">Certificación:</label>
      <select id="filtroCertificacion" [(ngModel)]="filtros.certificacion" (change)="aplicarFiltros()">
        <option value="">Todas</option>
        <option *ngFor="let c of certificacionesUnicas" [value]="c">{{c}}</option>
      </select>
    </div>

    <div class="filtro-item checkbox">
      <input type="checkbox" id="soloDisponibles" [(ngModel)]="filtros.soloDisponibles" (change)="aplicarFiltros()" />
      <label for="soloDisponibles">Solo disponibles</label>
    </div>

    <button class="btn-limpiar" (click)="limpiarFiltros()">Limpiar filtros</button>
  </div>

  <!-- Mensaje de carga -->
  <div *ngIf="cargando" class="cargando">
    <p>Cargando empleados...</p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="error" class="error-mensaje">
    <p>{{error}}</p>
  </div>

  <!-- Tabla de empleados -->
  <div class="tabla-container" *ngIf="!cargando && !error">
    <table class="tabla-empleados">
      <thead>
        <tr>
          <th>Empleado</th>
          <th>Rol</th>
          <th>Habilidades</th>
          <th>Proyectos</th>
          <th>Cargabilidad</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let empleado of paginatedEmpleados"
          [ngClass]="{'disponible': empleado.disponible, 'no-disponible': !empleado.disponible}"
        >
          <td (click)="verDetallesEmpleado(empleado)" style="cursor: pointer;">
            <div class="empleado-info">
              <div class="avatar"></div>
              <div>
                <p class="nombre">{{empleado.nombre}} {{empleado.apellido_paterno}}</p>
                <p class="usuario">{{empleado.usuario}}</p>
              </div>
            </div>
          </td>
          <td>
            <span class="chip" *ngFor="let rol of empleado.roles">{{ rol.nombre }}</span>
          </td>
          <td>
            <span class="chip small" *ngFor="let hab of empleado.habilidades.slice(0, 3)">{{ hab.nombre }}</span>
            <span *ngIf="empleado.habilidades.length > 3">+{{ empleado.habilidades.length - 3 }}</span>
          </td>
          <td>
            <span class="chip small" *ngFor="let proyecto of empleado.proyectos.slice(0, 2)">{{ proyecto.nombre }}</span>
            <span *ngIf="empleado.proyectos.length > 2">+{{ empleado.proyectos.length - 2 }}</span>
          </td>
          <td>
            <div class="cargabilidad-barra">
              <div class="cargabilidad-valor" [style.width.%]="empleado.cargabilidad"></div>
              <span>{{empleado.cargabilidad}}%</span>
            </div>
          </td>
          <td>
            <span class="estado" [ngClass]="{'disponible-badge': empleado.disponible, 'no-disponible-badge': !empleado.disponible}">
              {{ empleado.disponible ? 'Disponible' : empleado.razon }}
            </span>
          </td>
          <td>
            <button class="btn-accion" (click)="seleccionarEmpleado(empleado)">Editar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
