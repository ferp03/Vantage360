<div class="contenedor-detalle">
  <h1>Mi perfil</h1>
  <div class="caja-info" [ngClass]="{ 'editando': editandoInfo }">
    <div class="izquierda" [ngClass]="{ 'modo-edicion': editandoInfo }">
      <div class="izquierda-superior">
        <h3>{{ info.nombre }}</h3>

        <div *ngIf="!editandoInfo">
          <p><strong>correo:</strong> {{ info.correo }}</p>
          <p><strong>Usuario:</strong> {{ info.usuario }}</p>
        </div>

        <div *ngIf="editandoInfo">
          <p>
            <strong>correo:</strong>
            <input [(ngModel)]="info.correo" [class.error-input]="erroresInfo.correo" />
            <span class="error" *ngIf="erroresInfo.correo">Campo requerido</span>
            <span class="error" *ngIf="!erroresInfo.correo && erroresInfo.formatoEmail">Correo no válido</span>
          </p>

          <p>
            <strong>Usuario:</strong>
            <input [(ngModel)]="info.usuario" [class.error-input]="erroresInfo.usuario" />
            <span class="error" *ngIf="erroresInfo.usuario">Campo requerido</span>
          </p>
        </div>

        <p><strong>Desde:</strong> {{ info.desde }}</p>
        <p><strong>Cargabilidad:</strong> {{ info.cargabilidad }}%</p>

        <button *ngIf="editandoInfo" class="boton-cambiar-pass" (click)="mostrarModalContrasena = true">
          Cambiar contraseña
        </button>
      </div>

      <div class="izquierda-habilidades">
        <div class="habilidades">
          <div class="encabezado-habilidades">
            <h4>Habilidades</h4>
            <button *ngIf="editandoInfo" class="boton-agregar-habilidad" (click)="irARegistroHabilidades()">+</button>
          </div>

          <div class="etiquetas-habilidad">
            <span *ngFor="let habilidad of habilidades">{{ habilidad }}</span>
          </div>

          <h4>Cursos y Certificados</h4>
          <ul>
            <li *ngFor="let curso of cursos">
              {{ curso.nombre }} 
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="derecha"></div>

    <button class="boton-editar" (click)="toggleEditarInfo()">
      {{ editandoInfo ? 'Guardar' : 'Editar' }}
    </button>
  </div>

  <div class="carrera" [ngClass]="{ 'modo-edicion': editandoTrayectoria }">
    <h3>Trayectoria Laboral</h3>

    <div class="linea-tiempo">
      <div
        class="elemento-tiempo"
        *ngFor="let experiencia of experiencias; let i = index"
      >
        <button
          *ngIf="editandoTrayectoria"
          class="boton-editar-cuadro"
          (click)="toggleEditarTrayectoria(i)"
        >
          {{ editandoIndice === i ? 'Guardar' : 'Editar' }}
        </button>

        <div *ngIf="editandoIndice !== i">
          <h4>{{ experiencia.titulo }}</h4>
          <p style="color: #666; font-weight: normal;">{{ experiencia.titulo_proyecto}}</p>
          <p>{{ experiencia.empresa }}</p>
          <small>
            {{ experiencia.inicio | date: 'dd/MM/yyyy' }} -
            {{ experiencia.fin ? (experiencia.fin | date: 'dd/MM/yyyy') : 'Presente' }}
          </small>
          <p>{{ experiencia.descripcion }}</p>
        </div>

        <div *ngIf="editandoIndice === i" class="modo-edicion">
          <p>
            <strong>Título:</strong>
            <input [(ngModel)]="experiencia.titulo" [class.error-input]="errores[i].titulo" />
            <span class="error" *ngIf="errores[i].titulo">Campo requerido</span>
          </p>
          <p>
            <strong>Proyecto:</strong>
            <input [(ngModel)]="experiencia.titulo_proyecto" [class.error-input]="errores[i].titulo_proyecto" />
            <span class="error" *ngIf="errores[i].titulo_proyecto">Campo requerido</span>
          </p>
          <p>
            <strong>Empresa:</strong>
            <input [(ngModel)]="experiencia.empresa" [class.error-input]="errores[i].empresa" />
            <span class="error" *ngIf="errores[i].empresa">Campo requerido</span>
          </p>
          <p>
            <strong>Inicio:</strong>
            <input type="date" [(ngModel)]="experiencia.inicio" 
              [class.error-input]="errores[i].inicio"
              (change)="validarFechas(i)" />
            <span class="error" *ngIf="errores[i].inicio">Campo requerido</span>
          </p>
          <p>
            <strong>Fin:</strong>
            <input type="date" [(ngModel)]="experiencia.fin" 
              [class.error-input]="errores[i].fin || errores[i].fechaInvalida"
              (change)="validarFechas(i)" />
            <span class="error" *ngIf="errores[i].fin">Campo requerido</span>
            <span class="error" *ngIf="errores[i].fechaInvalida">La fecha de fin no puede ser anterior a la fecha de inicio</span>
          </p>
          <p>
            <strong>Descripción:</strong>
            <textarea [(ngModel)]="experiencia.descripcion" [class.error-input]="errores[i].descripcion"></textarea>
            <span class="error" *ngIf="errores[i].descripcion">Campo requerido</span>
          </p>
          <button *ngIf="experiencia.esNueva" class="boton-cancelar" (click)="cancelarNuevaExperiencia(i)">
            Cancelar
          </button>
        </div>
      </div>

      <div class="elemento-tiempo agregar-tarjeta" *ngIf="editandoTrayectoria && !existeExperienciaNueva()">
        <button class="boton-agregar-exp" (click)="agregarExperiencia()">+</button>
      </div>
    </div>

    <div class="boton-editar-trayectoria-global">
      <button (click)="guardarTrayectoria()" class="boton-editar">
        {{ editandoTrayectoria ? 'Guardar' : 'Editar' }}
      </button>
    </div>
  </div>

  <div class="modal" *ngIf="mostrarModalContrasena">
    <div class="modal-contenido">
      <h3>Cambiar contraseña</h3>

      <label>Contraseña actual:</label>
      <input type="password" [(ngModel)]="contrasenaActual" />
      <span class="error" *ngIf="erroresPass.actual">Campo requerido</span>

      <label>Nueva contraseña:</label>
      <input type="password" [(ngModel)]="nuevaContrasena" />
      <span class="error" *ngIf="erroresPass.nueva">La contraseña debe tener al menos 8 caracteres</span>

      <label>Confirmar nueva contraseña:</label>
      <input type="password" [(ngModel)]="confirmarContrasena" />
      <span class="error" *ngIf="erroresPass.confirmar">Las contraseñas no coinciden</span>

      <div class="acciones-modal">
        <button (click)="confirmarCambioContrasena()">Confirmar</button>
        <button class="cancelar" (click)="cerrarModalContrasena()">Cancelar</button>
      </div>
    </div>
  </div>
</div>
